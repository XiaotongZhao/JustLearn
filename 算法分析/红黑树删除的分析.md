**红黑树的删除**

对比插入红黑树的删除操作要复杂的多，其中的复杂主要是体现在删除的场景较多, 如果被删除的节点是红色节点的话，并不会破坏红黑树的基本性质，这种情况处理方式与平衡二叉树删除节点操作一样，但是如果被删除的节点是黑色的话，那么情况就要复杂的多，被删除的黑色节点的兄弟节点以及子节点都会因为颜色对应的红黑树的'再平衡'策略都会不一样，如下图红黑树

![image.png](/.attachments/image-8f221e19-6cd5-4709-a499-d0214f64dad6.png)

如果删除节点15,会变成这样

![image.png](/.attachments/image-fe36c830-0ebf-4ba2-b843-6702dc3b21cf.png)

由于15是红色节点，该树的黑高没变所以**性质5**没有被破坏，故该红黑树并没有被破坏,但是如果删除的是11情况就不一样了，如下图

![image.png](/.attachments/image-11ff66c8-2bb7-4462-afca-4aaaaad8e5c6.png)

你会看到节点11被删除后**黑色节点14**继承了**红色节点11**的位置,此时红黑树的黑高不一致了，**性质5**被破坏,表面上看，这与我之前所说的删除红色节点不会破坏红黑树相互矛盾，实际上从图中观察确实是删除了**红色节点11**，但是实际上**红色节点11**的并没有被删除，只是被**黑色节点14**所替代了，而此原本**黑色节点8**是**红色节点11**的左子节点但此刻却成为了**黑色节点8**与**红色节点15**的父节点

别忘了，红黑树存在的意义是为了让平衡二叉树**再次平衡**，它所具备的性质是让我们把关注点放在红黑树节点所处的位置上而不是节点上的数字

所以是否可以这样理解：

- 对于一颗平衡二叉树删除一个节点，意味着该节点值的丢失但并不意味该节点的位置一定会消失
- 对于一颗红黑树删除一个节点，意味着该节点会被其它位置的节点所替代，而接替该节点的节点会失去它原有的位置

所以基于这种理解，可以推断出被删除的是**黑色节点8**，由于删除的是黑色节点，从而导致了该红黑树的**性质5**被破坏了，这个时候我们通过以下几种处理情况来使红黑树再次恢复平衡

定义指针x指向被删除的节点的继任节点，ω定义为x的兄弟节点，如果左子节点为空，则x指向右子节点，如果右子节点为空，则x指向左子节点，若两者都指向了叶结点，我更倾向让x指向左子节点，**注意如果删除节点的左右子节点均不为空，那么x接必须要指向继任节点的右子节点**，

当黑色节点被删除的时候，红黑树的**性质5**一定会被破坏，**性质1，2，3**不可能会被破坏，**性质4**有可能被破坏，如果**性质4**被破坏优先恢复**性质4**，再恢复**性质5**，以下五种情况的应对策略是针对**性质5**的修复
- 状态1: ω是红色

当红黑树删除掉黑色节点时意味着该节点至上而下的新构建的子树缺少一个黑色节点，如果需要修复**性质5**就意味着需要把这一个黑色节点补回来,同时也不能够破坏**性质5**,对于**状态一**只能将**ω**节点染黑，但是别忘了**x**节点指向的是继承节点的子节点，而**ω**是在**x**确定后才会确定要指向的位置，删除节点的位置被继承节点替代，那么继承节点原有的位置将会被删除，所以我们可以推断**x**所在的那一侧缺少一个黑色节点，如果将**ω**染黑只会让右侧子树黑高加1这样只是会进一步破坏**性质5**，可以做如下变化，转换成**状态2，3，4**其中一种

![image.png](/.attachments/image-d4677866-859e-48cd-9dbd-a9da576f8d0c.png)

- 状态2: ω是黑色，且其两个子节点均为黑色

此时通过把**x**的父节点染黑，**ω**节点染红这样既可以增加左子树的黑高，还可以确保左右侧子树黑高不变，变化如下图
 
![image.png](/.attachments/image-e6621c5d-e0d0-45bc-b4f4-291b52f56aee.png)

- 状态3: ω是黑色，左子节点为红色，右子节点为黑色

**状态3**主要是为了转换成**状态4** ，此刻先对**ω**节点做右旋，此刻**性质4**被破坏，交换**ω**与父节点的颜色，并将**ω**指向其父节点，如下图

![image.png](/.attachments/image-2475a942-651f-4695-a86a-8f5a795f2b03.png)
- 状态4: ω是黑色， 右子节点为红色

先对**x父节点**做一次左旋，此时交换**ω**与**x父节点**的颜色，此时**ω**节点的颜色定义为**c**，**x父节点**为黑色，这时右子树现在的黑高为2，左子树黑高为0，变化前右侧黑高为1，所以将**ω**的右侧子节点染黑


这里需要注意的是即使不交换**ω**与**x父节点**颜色，也能够做到当前子树的左子树黑高加1，但是颜色为c'的节点在变化前它的父节点是黑色，假如不交换**ω**与**x父节点**颜色，那么颜色为c'的节点的父节点为红色，这里之所以设置为颜色为c'是因为这种情况下该节点的颜色无法判断，如果该节点为红色那么就会破坏**性质2**，因此交换颜色的操作并非可有可无

![image.png](/.attachments/image-600c9f29-0081-459a-8b44-12c32c4d179f.png)

注意:以上四种情况是基于x指向的是左子节点，如果是右节点，那么对调**左**,**右**即可

回到刚才的红黑树，如下图

![image.png](/.attachments/image-326cbd71-4a14-4a20-92a1-6b0e43e92248.png)

单独分析子树14，8，15，我可以看到ω是黑色且两个叶节点(**性质3**)均是黑色，这符合**情况2**因此可以做如下转换

![image.png](/.attachments/image-10131ab4-a464-4b8f-9758-241c32addea1.png)

调整后的红黑树如下图:

![image.png](/.attachments/image-26e807bf-aa7f-4168-b854-5f80777f23fa.png)

可以通过观察下面这个较为复杂的红黑树实例来理解四种状态的处理

![image.png](/.attachments/image-029e9a56-587a-40d8-bcef-f501ce69aa95.png)